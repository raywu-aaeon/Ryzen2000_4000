- [AAEON BIOS ME Capsule Update](#aaeon-bios-me-capsule-update)
- [FILES NOTE](#files-note)
  - [.sdl](#sdl)
  - [.c](#c)
- [PROJECT PORTING NOTE](#project-porting-note)

AAEON BIOS ME Capsule Update
================================

1.Support BIOS firmware update by capsule update.
  * This module support BIOS capsule update by Afu tool
  * For example: AfuEfix64 B641HM12.ROM /p /n /b /capsule
    (B641HM12.ROM is refer to FWCAPSULE_FILE_NAME)

2.Support BIOS+ME firmware update by capsule update.
  * This module support BIOS capsule update by Afu tool
  * Need enabled Me FW Image Re-Flash in BIOS menu first 
  * For example: AfuEfix64 B641HM12.CAP /p /n /b /capsule /meul
    (B641HM12.ROM is refer to FWCAPSULE_FILE_NAME)   

FILES NOTE
================================

## .sdl

* AaeonCapsuleUpdate.sdl - Main configurations to this module.

## .c

* AaeonCapsuleUpdate.c - Add ESRT firmware version patch to sync Windows firmware device version format in device manager.

PROJECT PORTING NOTE
================================
1. Generate and commit platform key pair by GenAmiCrbKey.bat
  * Sync new OemPublicKeyHash to project XML
  * Commit below two keys in "\RomImage\AmiCrbKeys\" before build BIOS
    â€‹ami_crb_priv_key.pem
    ami_crb_pub_key.pem
       
2. Generate and commit OemKey
  * Use administrator authority execute openssl.exe
    (OpenSSL.exe can find in project/RomImage/MEU/openssl)

  * Generate private key by the command: genrsa -out (root path of Private key) 2048   
    (For example: genrsa -out C:\CoffeeLake_BOXER-6641_H310\Keys\FW\OemPrikey 2048)

  * Generate public key by the command: rsa -in (root path of Private key) -pubout -out (root path of Public key)
    (For example: rsa -in C:\CoffeeLake_BOXER-6641_H310\Keys\FW\OemPrikey -pubout -out C:\CoffeeLake_BOXER-6641_H310\Keys\FW\OemPubkey)   

  * Put OemPriKey and OemPubKey in AaeonCapsuleUpdate\KEY

3. Set new GUID for token "OEM_ESRT_FIRMWARE_GUID"
  * GUID can generated by Online GUID / UUID Generator
    [Online GUID / UUID Generator](https://www.guidgenerator.com/)

3. Set new GUID for token "PLATFORM_GUID" & "FW_VERSION_GUID",and they should be same 

4. Make sure token value is same as the following
  * token "SECURE_FLASH_SUPPORT" = "1"
  * token "SecureMod_SUPPORT" = "1"
  * token "SMBIOS_DMIEDIT_DATA_LOC" = "2"
  * token "Recovery_SUPPORT" = "1"
  * token "BIOS_ME_FILE" value should be same as ME firmware of the project using
  * token "AUTO_MEUD_SUPPORT" = "1"
  * token "ROMHOLE_NUMBER_OF_BLOCK" value should be check if there was a build error with FV_LOGOROMHOLE

5. BIOS porting reference: CoffeeLake_BOXER-6641_H310_C246\CI-TestAaeonCapsuleUpdate
   GitLab:https://sts.aaeon.com.tw:11080/PAA/CoffeeLake_BOXER-6641_H310/branches
   SHA-1: c19c17c005c9dd71241206e5d83f7d0203620811  